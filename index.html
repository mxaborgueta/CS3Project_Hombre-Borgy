<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>QuakePH</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

html, body {
  height:100%;
  background:#0b0f19;
  font-family:Segoe UI, Tahoma, sans-serif;
  color:#e5e7eb;
  overflow:hidden;
}

.app {
  display:flex;
  height:100%;
}

/* ===== SIDEBAR ===== */
.sidebar {
  width:260px;
  background:linear-gradient(180deg,#0b0f19,#111827);
  border-right:1px solid #1f2933;
  padding:16px;
  transition:width .3s;
  position:relative;
}

.sidebar.collapsed { width:70px; }

.toggle {
  position:absolute;
  top:12px;
  right:-15px;
  width:36px;
  height:36px;
  border-radius:50%;
  background:#1f2933;
  border:1px solid #374151;
  color:#93c5fd;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.logo {
  text-align:center;
  font-weight:700;
  color:#93c5fd;
  margin-bottom:30px;
  white-space:nowrap;
}

.sidebar.collapsed .logo { opacity:0; }

.nav { list-style:none; }

.nav li {
  padding:14px;
  margin-bottom:12px;
  border-radius:6px;
  cursor:pointer;
  transition:.25s;
  display:flex;
  gap:12px;
}

.nav li span { white-space:nowrap; }

.sidebar.collapsed .nav span { opacity:0; }

.nav li:hover {
  background:rgba(59,130,246,.15);
  transform:translateX(6px);
}

.nav li.active {
  background:rgba(59,130,246,.25);
  font-weight:600;
}

/* ===== MAIN ===== */
.main { flex:1; position:relative; }

iframe, #leafletMap {
  width:100%;
  height:100%;
  border:none;
  display:none;
}

/* ===== PH BUTTON ===== */
.ph-btn {
  position:absolute;
  top:20px;
  right:20px;
  z-index:999;
  background:#1f2933;
  border:1px solid #374151;
  padding:10px 14px;
  color:#93c5fd;
  cursor:pointer;
  border-radius:6px;
}

/* ===== INFO PAGES ===== */
#info, #safety {
  padding:40px;
  display:none;
  height:100%;
  overflow-y:auto;
}

/* ===== SAFETY WALL OF TEXT ===== */
.safety-wall {
  max-width:1000px;
  margin:0 auto;
  padding:20px;
}

.safety-wall h1 {
  color:#93c5fd;
  font-size:2.5em;
  margin-bottom:30px;
  text-align:center;
  border-bottom:2px solid #374151;
  padding-bottom:20px;
}

.safety-wall h2 {
  color:#10b981;
  font-size:1.8em;
  margin:40px 0 20px 0;
  padding:15px;
  background:rgba(16, 185, 129, 0.1);
  border-radius:8px;
  border-left:4px solid #10b981;
}

.safety-wall h3 {
  color:#60a5fa;
  margin:25px 0 15px 0;
  font-size:1.4em;
}

.safety-wall p {
  line-height:1.7;
  margin-bottom:20px;
  font-size:1.1em;
}

.safety-wall ul, .safety-wall ol {
  margin:15px 0 25px 30px;
  line-height:1.7;
}

.safety-wall li {
  margin-bottom:12px;
  font-size:1.05em;
}

.safety-wall strong {
  color:#fbbf24;
}

/* Shake animation for during section */
@keyframes earthquakeShake {
  0%, 100% { transform: translate(0, 0) rotate(0); }
  10% { transform: translate(-3px, 2px) rotate(-0.5deg); }
  20% { transform: translate(3px, -2px) rotate(0.5deg); }
  30% { transform: translate(-2px, -3px) rotate(-0.3deg); }
  40% { transform: translate(2px, 3px) rotate(0.3deg); }
  50% { transform: translate(-1px, 2px) rotate(-0.2deg); }
  60% { transform: translate(1px, -2px) rotate(0.2deg); }
  70% { transform: translate(-2px, 1px) rotate(-0.3deg); }
  80% { transform: translate(2px, -1px) rotate(0.3deg); }
  90% { transform: translate(-1px, -2px) rotate(-0.2deg); }
}

.during-earthquake {
  animation: earthquakeShake 0.5s linear infinite;
  background:rgba(245, 158, 11, 0.05);
  border-left:4px solid #f59e0b !important;
  position:relative;
}

.during-earthquake::before {
  content:"‚ö†Ô∏è SHAKING! ‚ö†Ô∏è";
  display:block;
  color:#f59e0b;
  font-weight:bold;
  text-align:center;
  margin-bottom:15px;
  font-size:1.2em;
  background:rgba(245, 158, 11, 0.2);
  padding:10px;
  border-radius:6px;
}

.after-earthquake {
  border-left:4px solid #ef4444 !important;
  background:rgba(239, 68, 68, 0.05);
}

.emergency-box {
  background:rgba(239,68,68,0.1);
  border:2px solid rgba(239,68,68,0.3);
  border-radius:10px;
  padding:25px;
  margin:30px 0;
}

.emergency-box h3 {
  color:#ef4444 !important;
  margin-top:0 !important;
}

.emergency-box ul {
  margin:15px 0 0 20px !important;
}

.important-note {
  background:rgba(251,191,36,0.1);
  border:1px solid rgba(251,191,36,0.3);
  border-radius:8px;
  padding:20px;
  margin:25px 0;
}

.important-note strong {
  color:#fbbf24;
  font-size:1.1em;
}

.source {
  font-size:0.9em;
  color:#9ca3af;
  margin-top:50px;
  padding-top:25px;
  border-top:1px solid #374151;
  text-align:center;
  font-style:italic;
}

/* Earthquake List Styles */
.quake-list {
  background:rgba(15, 23, 42, 0.95) !important;
  backdrop-filter: blur(10px);
  border:1px solid #374151 !important;
  color:#e5e7eb !important;
  max-height:400px !important;
  overflow-y:auto !important;
  padding:15px !important;
  border-radius:8px !important;
  box-shadow:0 4px 20px rgba(0,0,0,0.5) !important;
  z-index:1000 !important;
}

.quake-list b {
  color:#93c5fd !important;
  display:block;
  margin-bottom:10px;
  font-size:1.1em;
}

.quake-list hr {
  border-color:#374151 !important;
  margin:10px 0 !important;
}

.quake-list ul {
  list-style:none !important;
  padding:0 !important;
  margin:0 !important;
}

.quake-list li {
  padding:8px 12px !important;
  margin-bottom:8px !important;
  background:rgba(31,41,51,0.6);
  border-radius:6px;
  border-left:3px solid;
  cursor:pointer;
  transition:all 0.2s;
}

.quake-list li:hover {
  background:rgba(59,130,246,0.2);
  transform:translateX(3px);
}

.legend {
  background:rgba(15, 23, 42, 0.95) !important;
  backdrop-filter: blur(10px);
  border:1px solid #374151 !important;
  color:#e5e7eb !important;
  padding:12px !important;
  border-radius:8px !important;
  box-shadow:0 4px 20px rgba(0,0,0,0.5) !important;
}

.legend b {
  color:#93c5fd !important;
  display:block;
  margin-bottom:8px;
}

/* Responsive */
@media (max-width: 768px) {
  #info, #safety {
    padding:20px 15px;
  }
  
  .safety-wall h1 {
    font-size:2em;
  }
  
  .safety-wall h2 {
    font-size:1.6em;
  }
  
  .quake-list {
    width:250px !important;
    max-height:350px !important;
  }
}
</style>
</head>

<body>
<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="toggle" id="toggle">‚ò∞</div>
  <div class="logo">QuakePH</div>

  <ul class="nav">
    <li class="active" data-tab="hazard">üåé <span>Global Hazard</span></li>
    <li data-tab="risk">‚ö†Ô∏è <span>Global Risk</span></li>
    <li data-tab="recent">üìç <span>Recent Earthquakes</span></li>
    <li data-tab="safety">üõ°Ô∏è <span>Earthquake Safety</span></li>
    <li data-tab="about">‚ÑπÔ∏è <span>About</span></li>
  </ul>
</aside>

<!-- MAIN -->
<main class="main">

  <!-- OpenQuake -->
  <iframe id="hazard"
    src="https://maps.openquake.org/map/global-seismic-hazard-map/"
    style="display:block;"></iframe>

  <iframe id="risk"
    src="https://b.maps.openquake.org/map/grm-2023-1/"></iframe>

  <!-- Leaflet -->
  <div id="leafletMap"></div>

  <!-- About Info -->
  <div id="info">
    <h1>About QuakePH</h1>
    <p>
      Intelligence-style earthquake dashboard combining global hazard
      models with live USGS earthquake feeds and fault line overlays.
    </p>
  </div>

  <!-- Safety Wall of Text -->
  <div id="safety">
    <div class="safety-wall">
      <h1>üåç COMPREHENSIVE EARTHQUAKE SAFETY GUIDE</h1>
      
      <h2>BEFORE AN EARTHQUAKE: PREPARATION IS EVERYTHING</h2>
      
      <p>The most effective way to survive an earthquake is through thorough preparation. Earthquakes strike without warning, but with proper planning, you can significantly increase your chances of staying safe and minimizing damage.</p>
      
      <h3>Create a Family Emergency Plan</h3>
      <ul>
        <li><strong>Designate meeting points:</strong> Choose one location near your home and another outside your neighborhood in case you cannot return home.</li>
        <li><strong>Establish communication methods:</strong> Identify an out-of-town contact person everyone can call to check in. Text messages often work when phone calls don't.</li>
        <li><strong>Practice evacuation drills:</strong> Conduct regular drills so everyone knows exactly what to do and where to go.</li>
        <li><strong>Plan for special needs:</strong> Include provisions for children, elderly family members, and pets in your emergency plans.</li>
      </ul>
      
      <h3>Build a Comprehensive Emergency Kit</h3>
      <p>Prepare supplies to last at least 72 hours (3 days) for each family member:</p>
      <ul>
        <li><strong>Water:</strong> One gallon per person per day (minimum 3 gallons per person)</li>
        <li><strong>Non-perishable food:</strong> Canned goods, energy bars, dried fruits, and other foods that don't require refrigeration or cooking</li>
        <li><strong>First aid supplies:</strong> Bandages, antiseptics, pain relievers, prescription medications (7-day supply)</li>
        <li><strong>Emergency tools:</strong> Flashlight with extra batteries, battery-powered or hand-crank radio, multi-tool, whistle</li>
        <li><strong>Sanitation supplies:</strong> Toilet paper, garbage bags, personal hygiene items, disinfectant</li>
        <li><strong>Important documents:</strong> Copies of identification, insurance policies, medical records in waterproof container</li>
        <li><strong>Cash:</strong> Small bills and coins (ATMs and credit card systems may not work)</li>
        <li><strong>Special items:</strong> Baby supplies, pet food, extra glasses, hearing aid batteries</li>
      </ul>
      
      <div class="important-note">
        <strong>PRO TIP:</strong> Store emergency supplies in multiple locations - at home, in your car, and at work. Rotate supplies every 6 months to ensure freshness.
      </div>
      
      <h3>Earthquake-Proof Your Home</h3>
      <ul>
        <li><strong>Secure heavy furniture:</strong> Anchor bookshelves, cabinets, and appliances to wall studs</li>
        <li><strong>Protect overhead items:</strong> Secure ceiling fans, light fixtures, and hanging plants</li>
        <li><strong>Safeguard glass:</strong> Install safety film on windows and use latches on cabinet doors</li>
        <li><strong>Know utility shut-offs:</strong> Learn how to turn off gas, water, and electricity - keep necessary tools nearby</li>
        <li><strong>Prepare structural improvements:</strong> Consider retrofitting if you live in an older home or in a high-risk area</li>
      </ul>
      
      <h2 class="during-earthquake">DURING AN EARTHQUAKE: IMMEDIATE ACTION SAVES LIVES</h2>
      
      <div class="important-note">
        <strong>THE GOLDEN RULE: DROP, COVER, AND HOLD ON!</strong> This simple action dramatically increases your chances of survival during strong shaking.
      </div>
      
      <h3>If You Are Indoors</h3>
      <ul>
        <li><strong>DROP</strong> to your hands and knees immediately when shaking begins</li>
        <li><strong>COVER</strong> your head and neck with your arms, or crawl under a sturdy table or desk</li>
        <li><strong>HOLD ON</strong> to your shelter until the shaking stops completely</li>
        <li>Stay away from windows, glass, exterior walls, and hanging objects</li>
        <li><strong>DO NOT RUN OUTSIDE</strong> during shaking - falling debris is a major danger</li>
        <li>If in bed, stay there and protect your head with a pillow</li>
        <li>If no shelter is available, crouch in an interior corner away from windows</li>
      </ul>
      
      <h3>If You Are Outdoors</h3>
      <ul>
        <li>Move to an open area away from buildings, trees, streetlights, and utility wires</li>
        <li>Drop to the ground to prevent being knocked down</li>
        <li>Protect your head and neck with your arms</li>
        <li>Stay low until the shaking stops completely</li>
        <li>Watch for falling debris from buildings and other structures</li>
        <li>If near slopes, be alert for falling rocks and landslides</li>
      </ul>
      
      <h3>If You Are Driving</h3>
      <ul>
        <li>Pull over to a clear location, avoiding bridges, overpasses, and power lines</li>
        <li>Set the parking brake and stay inside the vehicle</li>
        <li>Turn on the radio for emergency information</li>
        <li>Proceed carefully once shaking stops, watching for road damage</li>
        <li>If a power line falls on your car, stay inside until trained personnel remove it</li>
      </ul>
      
      <h3>If You Are in a Wheelchair or Mobility Device</h3>
      <ul>
        <li>Lock your wheels and remain seated</li>
        <li>Protect your head and neck with your arms, a pillow, or book</li>
        <li>Move away from windows and hanging objects if possible</li>
      </ul>
      
      <h2 class="after-earthquake">AFTER AN EARTHQUAKE: CAUTION AND COMMUNICATION</h2>
      
      <p>The immediate aftermath of an earthquake can be as dangerous as the shaking itself. Proceed with extreme caution and follow these guidelines.</p>
      
      <h3>Immediate Actions After Shaking Stops</h3>
      <ul>
        <li><strong>Check for injuries:</strong> Provide first aid to yourself and others if trained</li>
        <li><strong>Expect aftershocks:</strong> These can be nearly as strong as the main quake - be ready to Drop, Cover, and Hold On again</li>
        <li><strong>Look for small fires:</strong> Extinguish them immediately if safe to do so</li>
        <li><strong>Listen to emergency broadcasts:</strong> Use a battery-powered radio for official information</li>
        <li><strong>Use phones sparingly:</strong> Only make emergency calls - text messages use less bandwidth</li>
        <li><strong>Check your home:</strong> Look for structural damage before re-entering buildings</li>
      </ul>
      
      <h3>Safety Inspection of Your Property</h3>
      <ul>
        <li><strong>Gas leaks:</strong> If you smell gas or hear a hissing sound, shut off the main valve and evacuate immediately</li>
        <li><strong>Electrical damage:</strong> Look for sparking wires or damaged electrical systems - shut off power at the main breaker if unsafe</li>
        <li><strong>Water pipes:</strong> Check for broken pipes and sewage lines - shut off water if necessary</li>
        <li><strong>Hazardous materials:</strong> Clean up spilled chemicals, medicines, or other dangerous substances</li>
        <li><strong>Document damage:</strong> Take photographs for insurance claims before cleaning up</li>
      </ul>
      
      <div class="emergency-box">
        <h3>‚ö†Ô∏è PHILIPPINE EMERGENCY CONTACTS ‚ö†Ô∏è</h3>
        <ul>
          <li><strong>Nationwide Emergency Hotline:</strong> 911</li>
          <li><strong>Philippine Institute of Volcanology and Seismology (PHIVOLCS):</strong> (02) 8426-1468 to 79</li>
          <li><strong>National Disaster Risk Reduction and Management Council (NDRRMC):</strong> (02) 8911-1406, (02) 8911-5061 to 65</li>
          <li><strong>Philippine Red Cross:</strong> 143, (02) 8790-2300</li>
          <li><strong>Bureau of Fire Protection (BFP):</strong> (02) 8426-0219, 160</li>
          <li><strong>Department of Health (DOH) Hotline:</strong> 1555</li>
          <li><strong>Metro Manila Development Authority (MMDA):</strong> 136</li>
        </ul>
      </div>
      
      <h3>If You Are Trapped Under Debris</h3>
      <ul>
        <li>Stay calm and conserve energy - you may need to wait for rescuers</li>
        <li>Tap on pipes or walls to help rescuers locate you</li>
        <li>Use a whistle if available - shouting should be a last resort to avoid inhaling dust</li>
        <li>Cover your mouth with clothing to filter dust and debris</li>
        <li>Move carefully to avoid disturbing the debris around you</li>
      </ul>
      
      <h3>Community Response and Recovery</h3>
      <ul>
        <li>Check on neighbors, especially elderly, disabled, or those living alone</li>
        <li>Work with community organizations and follow instructions from local authorities</li>
        <li>Report hazards like downed power lines, gas leaks, or damaged buildings</li>
        <li>Only enter damaged buildings when authorities declare them safe</li>
        <li>Be prepared for potential evacuation orders</li>
        <li>Participate in community clean-up efforts when it's safe to do so</li>
      </ul>
      
      <h3>Psychological First Aid</h3>
      <p>Earthquakes can be traumatic events. Remember to:</p>
      <ul>
        <li>Acknowledge and validate feelings of fear, anxiety, or stress</li>
        <li>Maintain routines as much as possible, especially for children</li>
        <li>Talk about the experience with trusted friends or family</li>
        <li>Seek professional help if feelings of distress persist</li>
        <li>Practice self-care: eat regularly, stay hydrated, and rest when possible</li>
      </ul>
      
      <div class="source">
        <p>Information compiled from: PHIVOLCS, NDRRMC, USGS, Philippine Red Cross, FEMA, and World Health Organization guidelines</p>
        <p><strong>REMEMBER:</strong> The time to prepare is NOW. Regularly review and practice your earthquake safety plans with all household members.</p>
      </div>
    </div>
  </div>

</main>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== UI ===== */
const sidebar = document.getElementById("sidebar");
document.getElementById("toggle").onclick =
  () => sidebar.classList.toggle("collapsed");

const tabs = document.querySelectorAll(".nav li");
const hazard = document.getElementById("hazard");
const risk = document.getElementById("risk");
const mapDiv = document.getElementById("leafletMap");
const info = document.getElementById("info");
const safety = document.getElementById("safety");

/* ===== LEAFLET MAP ===== */
const map = L.map("leafletMap").setView([12.5, 121], 5);

L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
  attribution: "&copy; OpenStreetMap"
}).addTo(map);

/* FAULT LINES (replace with PHIVOLCS if available) */
fetch("https://raw.githubusercontent.com/fraxen/tectonicplates/master/GeoJSON/PB2002_boundaries.json")
  .then(r => r.json())
  .then(d => L.geoJSON(d, {
    style:{ color:"#facc15", weight:1 }
  }).addTo(map));

/* ===== RECENT EARTHQUAKES INTERFACE ===== */
let quakeLayer = L.layerGroup().addTo(map);

// Create earthquake list control
const quakeListControl = L.control({ position: "topright" });

quakeListControl.onAdd = function () {
  const div = L.DomUtil.create("div", "quake-list");
  div.innerHTML = "<b>Recent Earthquakes (24h)</b><hr>";
  return div;
};

// Create legend control
const legend = L.control({ position: "bottomleft" });

legend.onAdd = function () {
  const div = L.DomUtil.create("div", "legend");
  div.innerHTML = `
    <b>Magnitude</b><br>
    <span style="color:#00ff00">‚óè</span> &lt; 2<br>
    <span style="color:#ffff00">‚óè</span> 2 ‚Äì 3.9<br>
    <span style="color:#ff8000">‚óè</span> 4 ‚Äì 5.9<br>
    <span style="color:#ff0000">‚óè</span> ‚â• 6
  `;
  return div;
};

// Function to load earthquake data
function loadEarthquakeData() {
  quakeLayer.clearLayers();
  
  fetch("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson")
    .then(res => res.json())
    .then(data => {
      const quakeListDiv = document.querySelector(".quake-list");
      if (quakeListDiv) {
        quakeListDiv.innerHTML = "<b>Recent Earthquakes (24h)</b><hr><ul style='list-style:none;padding:0;margin:0'></ul>";
        const list = quakeListDiv.querySelector("ul");
        
        L.geoJSON(data, {
          pointToLayer: (feature, latlng) => {
            const mag = feature.properties.mag || 0;
            const time = new Date(feature.properties.time).toLocaleString();
            const place = feature.properties.place;

            const color =
              mag < 2 ? "#00ff00" :
              mag < 4 ? "#ffff00" :
              mag < 6 ? "#ff8000" :
                        "#ff0000";

            const marker = L.circleMarker(latlng, {
              radius: mag * 3,
              fillColor: color,
              color: "#000",
              weight: 1,
              fillOpacity: 0.7
            }).bindPopup(`
              <b>${place}</b><br>
              Magnitude: ${mag}<br>
              Time: ${time}
            `);

            // Add to sidebar list
            const li = document.createElement("li");
            li.innerHTML = `
              <span style="color:${color};font-weight:bold">‚óè</span>
              M${mag} ‚Äî ${place.split(",").pop()}
            `;
            li.onclick = () => {
              map.setView(latlng, 7);
              marker.openPopup();
            };

            if (list) {
              list.appendChild(li);
            }

            return marker;
          }
        }).addTo(quakeLayer);
      }
    })
    .catch(error => {
      console.error("Error loading earthquake data:", error);
    });
}

/* ===== NAVIGATION ===== */
tabs.forEach(t => t.onclick = () => {
  tabs.forEach(x => x.classList.remove("active"));
  t.classList.add("active");

  hazard.style.display =
  risk.style.display =
  mapDiv.style.display =
  info.style.display =
  safety.style.display = "none";

  if (t.dataset.tab === "hazard") hazard.style.display = "block";
  if (t.dataset.tab === "risk") risk.style.display = "block";
  if (t.dataset.tab === "recent") {
    mapDiv.style.display = "block";
    
    // Add controls only once when showing recent earthquakes
    if (!document.querySelector(".quake-list")) {
      quakeListControl.addTo(map);
      legend.addTo(map);
    }
    
    // Load earthquake data and resize map
    loadEarthquakeData();
    map.invalidateSize();
    
    // Auto-refresh data every 5 minutes
    setInterval(loadEarthquakeData, 300000);
  }
  if (t.dataset.tab === "about") info.style.display = "block";
  if (t.dataset.tab === "safety") {
    safety.style.display = "block";
  }
});

// Initial load of the active tab
document.querySelector('.nav li.active').click();
</script>
</body>
</html>