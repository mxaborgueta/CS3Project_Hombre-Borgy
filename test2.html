<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>QuakePH</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

html, body {
  height:100%;
  background:#0b0f19;
  font-family:Segoe UI, Tahoma, sans-serif;
  color:#e5e7eb;
  overflow:hidden;
}

.app {
  display:flex;
  height:100%;
}

/* ===== SIDEBAR ===== */
.sidebar {
  width:260px;
  background:linear-gradient(180deg,#0b0f19,#111827);
  border-right:1px solid #1f2933;
  padding:16px;
  transition:width .3s;
  position:relative;
}

.sidebar.collapsed { width:70px; }

.toggle {
  position:absolute;
  top:12px;
  right:-15px;
  width:36px;
  height:36px;
  border-radius:50%;
  background:#1f2933;
  border:1px solid #374151;
  color:#93c5fd;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.logo {
  text-align:center;
  font-weight:700;
  color:#93c5fd;
  margin-bottom:30px;
  white-space:nowrap;
}

.sidebar.collapsed .logo { opacity:0; }

.nav { list-style:none; }

.nav li {
  padding:14px;
  margin-bottom:12px;
  border-radius:6px;
  cursor:pointer;
  transition:.25s;
  display:flex;
  gap:12px;
}

.nav li span { white-space:nowrap; }

.sidebar.collapsed .nav span { opacity:0; }

.nav li:hover {
  background:rgba(59,130,246,.15);
  transform:translateX(6px);
}

.nav li.active {
  background:rgba(59,130,246,.25);
  font-weight:600;
}

/* ===== MAIN ===== */
.main { flex:1; position:relative; }

iframe, #leafletMap {
  width:100%;
  height:100%;
  border:none;
  display:none;
}

/* ===== PH BUTTON ===== */
.ph-btn {
  position:absolute;
  top:20px;
  right:20px;
  z-index:999;
  background:#1f2933;
  border:1px solid #374151;
  padding:10px 14px;
  color:#93c5fd;
  cursor:pointer;
  border-radius:6px;
}

/* ===== INFO PAGES ===== */
#info, #safety {
  padding:40px;
  display:none;
  height:100%;
  overflow-y:auto;
}

/* ===== SAFETY CAROUSEL ===== */
.safety-carousel {
  max-width:900px;
  margin:0 auto;
  height:100%;
  display:flex;
  flex-direction:column;
}

.safety-header {
  text-align:center;
  margin-bottom:30px;
  flex-shrink: 0;
}

.safety-header h1 {
  color:#93c5fd;
  font-size:2.5em;
  margin-bottom:10px;
}

.safety-header p {
  color:#9ca3af;
  font-size:1.1em;
}

.carousel-container {
  flex:1;
  position:relative;
  overflow:hidden;
  border-radius:12px;
  background:rgba(31,41,51,0.3);
  border:1px solid #374151;
}

.safety-slide {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  opacity:0;
  transform:translateX(50px);
  transition:all 0.5s ease;
  pointer-events: none;
}

.safety-slide.active {
  opacity:1;
  transform:translateX(0);
  pointer-events: auto;
}

.safety-slide.prev {
  opacity:0;
  transform:translateX(-50px);
}

.safety-slide.next {
  opacity:0;
  transform:translateX(50px);
}

/* Shake animation for during section */
@keyframes earthquakeShake {
  0%, 100% { transform: translate(0, 0) rotate(0); }
  10% { transform: translate(-3px, 2px) rotate(-0.5deg); }
  20% { transform: translate(3px, -2px) rotate(0.5deg); }
  30% { transform: translate(-2px, -3px) rotate(-0.3deg); }
  40% { transform: translate(2px, 3px) rotate(0.3deg); }
  50% { transform: translate(-1px, 2px) rotate(-0.2deg); }
  60% { transform: translate(1px, -2px) rotate(0.2deg); }
  70% { transform: translate(-2px, 1px) rotate(-0.3deg); }
  80% { transform: translate(2px, -1px) rotate(0.3deg); }
  90% { transform: translate(-1px, -2px) rotate(-0.2deg); }
}

/* Apply shake to only the during slide */
#slide2.active .slide-scrollable {
  animation: earthquakeShake 0.5s linear infinite;
}

.slide-scrollable {
  width:100%;
  height:100%;
  padding:40px;
  overflow-y:auto;
  position:relative;
}

.slide-indicator {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:15px;
  margin:30px 0;
  flex-shrink: 0;
}

.slide-dot {
  width:12px;
  height:12px;
  border-radius:50%;
  background:#374151;
  cursor:pointer;
  transition:all 0.3s;
}

.slide-dot.active {
  background:#3b82f6;
  transform:scale(1.3);
}

.slide-content {
  max-width:800px;
  margin:0 auto;
}

.safety-section {
  margin-bottom:30px;
  padding:25px;
  background:rgba(31,41,51,0.5);
  border-radius:8px;
  border-left:4px solid;
}

.safety-section.before { border-left-color: #10b981; }
.safety-section.during { border-left-color: #f59e0b; }
.safety-section.after { border-left-color: #ef4444; }

.safety-section h2 {
  color:#93c5fd;
  margin-bottom:15px;
  display:flex;
  align-items:center;
  gap:10px;
  font-size:1.8em;
}

.safety-section h3 {
  color:#60a5fa;
  margin:20px 0 10px 0;
  font-size:1.3em;
}

.safety-section ul {
  margin-left:20px;
  margin-bottom:15px;
}

.safety-section li {
  margin-bottom:10px;
  line-height:1.6;
  font-size:1.05em;
}

.tip-box {
  background:rgba(251,191,36,0.1);
  border:1px solid rgba(251,191,36,0.3);
  border-radius:6px;
  padding:20px;
  margin:20px 0;
}

.tip-box strong {
  color:#fbbf24;
  font-size:1.1em;
}

.emergency-numbers {
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
  gap:15px;
  margin:20px 0;
}

.emergency-card {
  background:rgba(239,68,68,0.1);
  border:1px solid rgba(239,68,68,0.3);
  border-radius:6px;
  padding:15px;
}

.emergency-card strong {
  color:#ef4444;
}

.carousel-nav {
  display:flex;
  justify-content:space-between;
  margin-top:20px;
  flex-shrink: 0;
}

.nav-btn {
  background:#1f2933;
  border:1px solid #374151;
  color:#93c5fd;
  padding:12px 24px;
  border-radius:6px;
  cursor:pointer;
  font-size:1em;
  display:flex;
  align-items:center;
  gap:8px;
  transition:all 0.3s;
}

.nav-btn:hover {
  background:#374151;
  transform:translateY(-2px);
}

.nav-btn:disabled {
  opacity:0.5;
  cursor:not-allowed;
  transform:none;
}

.source {
  font-size:0.9em;
  color:#9ca3af;
  margin-top:30px;
  padding-top:20px;
  border-top:1px solid #374151;
  text-align:center;
  flex-shrink: 0;
}

/* Scrollbar styling */
.slide-scrollable::-webkit-scrollbar {
  width:8px;
}

.slide-scrollable::-webkit-scrollbar-track {
  background:rgba(31,41,51,0.3);
  border-radius:4px;
}

.slide-scrollable::-webkit-scrollbar-thumb {
  background:#374151;
  border-radius:4px;
}

.slide-scrollable::-webkit-scrollbar-thumb:hover {
  background:#4b5563;
}

/* Responsive */
@media (max-width: 768px) {
  #info, #safety {
    padding:20px 15px;
  }
  
  .safety-header {
    margin-bottom:20px;
  }
  
  .safety-header h1 {
    font-size:2em;
  }
  
  .slide-scrollable {
    padding:20px;
  }
  
  .safety-section {
    padding:15px;
  }
  
  .carousel-nav {
    flex-direction:column;
    gap:15px;
  }
  
  .nav-btn {
    width:100%;
    justify-content:center;
  }
  
  .safety-carousel {
    height:calc(100vh - 40px);
  }
}
</style>
</head>

<body>
<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="toggle" id="toggle">‚ò∞</div>
  <div class="logo">QuakePH</div>

  <ul class="nav">
    <li class="active" data-tab="hazard">üåé <span>Global Hazard</span></li>
    <li data-tab="risk">‚ö†Ô∏è <span>Global Risk</span></li>
    <li data-tab="recent">üìç <span>Recent Earthquakes</span></li>
    <li data-tab="safety">üõ°Ô∏è <span>Earthquake Safety</span></li>
    <li data-tab="about">‚ÑπÔ∏è <span>About</span></li>
  </ul>
</aside>

<!-- MAIN -->
<main class="main">

  <!-- OpenQuake -->
  <iframe id="hazard"
    src="https://maps.openquake.org/map/global-seismic-hazard-map/"
    style="display:block;"></iframe>

  <iframe id="risk"
    src="https://b.maps.openquake.org/map/grm-2023-1/"></iframe>

  <!-- Leaflet -->
  <div id="leafletMap"></div>
  <button class="ph-btn" id="phFocus" style="display:none;">
    üáµüá≠ Focus Philippines
  </button>

  <!-- About Info -->
  <div id="info">
    <h1>About QuakePH</h1>
    <p>
      Intelligence-style earthquake dashboard combining global hazard
      models with live USGS earthquake feeds and fault line overlays.
    </p>
  </div>

  <!-- Safety Carousel -->
  <div id="safety">
    <div class="safety-carousel">
      <div class="safety-header">
        <h1>üåç Earthquake Safety Guide</h1>
        <p>Learn what to do before, during, and after an earthquake</p>
      </div>

      <div class="carousel-container" id="carouselContainer">
        <!-- Slide 1: Before -->
        <div class="safety-slide active" id="slide1">
          <div class="slide-scrollable">
            <div class="slide-content">
              <div class="safety-section before">
                <h2>üõ°Ô∏è BEFORE an Earthquake</h2>
                
                <h3>Preparation is Key</h3>
                <ul>
                  <li>Create an emergency plan with your family</li>
                  <li>Identify safe spots in each room (under sturdy furniture, against interior walls)</li>
                  <li>Practice "Drop, Cover, and Hold On" drills regularly</li>
                  <li>Secure heavy furniture, appliances, and hanging objects to walls</li>
                  <li>Know how to turn off gas, water, and electricity mains</li>
                  <li>Learn first aid and CPR basics</li>
                </ul>
                
                <h3>Build Your Emergency Kit</h3>
                <ul>
                  <li>Water (1 gallon per person per day for at least 3 days)</li>
                  <li>Non-perishable food (3-day supply minimum)</li>
                  <li>First aid kit, medications, and prescription drugs</li>
                  <li>Flashlight with extra batteries</li>
                  <li>Portable radio (battery-powered or hand-crank)</li>
                  <li>Important documents in waterproof container</li>
                  <li>Whistle to signal for help</li>
                  <li>Dust masks and plastic sheeting</li>
                  <li>Personal hygiene items</li>
                  <li>Cash in small bills</li>
                </ul>
                
                <h3>Home Safety Check</h3>
                <ul>
                  <li>Install latches on cabinet doors</li>
                  <li>Use flexible connections on gas appliances</li>
                  <li>Anchor water heaters and large appliances</li>
                  <li>Secure overhead light fixtures</li>
                  <li>Keep breakable items on lower shelves</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 2: During -->
        <div class="safety-slide" id="slide2">
          <div class="slide-scrollable">
            <div class="slide-content">
              <div class="safety-section during" id="duringSection">
                <h2>üèÉ‚Äç‚ôÇÔ∏è DURING an Earthquake</h2>
                
                <div class="tip-box" style="background:rgba(245,158,11,0.15);">
                  <strong>REMEMBER: DROP, COVER, and HOLD ON!</strong>
                  <p>This is the most important action to protect yourself during shaking</p>
                </div>
                
                <h3>If you are INDOORS:</h3>
                <ul>
                  <li>DROP to your hands and knees immediately</li>
                  <li>COVER your head and neck with your arms</li>
                  <li>Take shelter under a sturdy table or desk</li>
                  <li>HOLD ON to your shelter until shaking stops</li>
                  <li>Stay away from windows, outside walls, and glass</li>
                  <li>DO NOT run outside during shaking</li>
                  <li>If in bed, stay there and protect your head with a pillow</li>
                </ul>
                
                <h3>If you are OUTDOORS:</h3>
                <ul>
                  <li>Move to an open area away from buildings, trees, and power lines</li>
                  <li>Drop to the ground and protect your head</li>
                  <li>Stay low until shaking stops completely</li>
                  <li>Watch for falling debris</li>
                  <li>Avoid streetlights and utility wires</li>
                </ul>
                
                <h3>If you are DRIVING:</h3>
                <ul>
                  <li>Pull over to a clear location, set parking brake</li>
                  <li>Avoid overpasses, bridges, power lines, and signs</li>
                  <li>Stay inside the vehicle until shaking stops</li>
                  <li>Once shaking stops, proceed carefully</li>
                  <li>Watch for road damage, fallen objects, or downed power lines</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 3: After -->
        <div class="safety-slide" id="slide3">
          <div class="slide-scrollable">
            <div class="slide-content">
              <div class="safety-section after">
                <h2>üö® AFTER an Earthquake</h2>
                
                <h3>Immediate Actions:</h3>
                <ul>
                  <li>Check yourself and others for injuries - provide first aid if trained</li>
                  <li>Expect aftershocks - be prepared to Drop, Cover, and Hold On again</li>
                  <li>Look for and extinguish small fires</li>
                  <li>Listen to battery-powered radio for emergency information</li>
                  <li>Use phone only for life-threatening emergencies</li>
                  <li>Text instead of call if possible</li>
                </ul>
                
                <h3>Home Inspection:</h3>
                <ul>
                  <li>Check for gas leaks - if you smell gas, shut off main valve and evacuate</li>
                  <li>Look for electrical system damage - shut off power at main breaker if unsafe</li>
                  <li>Inspect water lines for damage</li>
                  <li>Clean up spilled medicines, bleach, or other hazardous materials</li>
                  <li>Check for structural damage before re-entering</li>
                </ul>
                
                <div class="emergency-numbers">
                  <div class="emergency-card">
                    <strong>Philippine Emergency Numbers:</strong>
                    <p>PHIVOLCS: (02) 8426-1468 to 79</p>
                    <p>NDRRMC: (02) 8911-1406</p>
                    <p>Emergency: 911</p>
                    <p>Red Cross: 143</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide Indicator Dots -->
      <div class="slide-indicator">
        <div class="slide-dot active" data-slide="1"></div>
        <div class="slide-dot" data-slide="2"></div>
        <div class="slide-dot" data-slide="3"></div>
      </div>

      <!-- Navigation Buttons -->
      <div class="carousel-nav">
        <button class="nav-btn" id="prevBtn" disabled>
          ‚Üê Previous
        </button>
        <button class="nav-btn" id="nextBtn">
          Next ‚Üí
        </button>
      </div>

      <div class="source">
        <p>Information sourced from: PHIVOLCS, NDRRMC, USGS, Red Cross, and FEMA guidelines</p>
        <p><em>Remember: The best earthquake protection is preparation and knowledge.</em></p>
      </div>
    </div>
  </div>

</main>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== UI ===== */
const sidebar = document.getElementById("sidebar");
document.getElementById("toggle").onclick =
  () => sidebar.classList.toggle("collapsed");

const tabs = document.querySelectorAll(".nav li");
const hazard = document.getElementById("hazard");
const risk = document.getElementById("risk");
const mapDiv = document.getElementById("leafletMap");
const info = document.getElementById("info");
const safety = document.getElementById("safety");
const phBtn = document.getElementById("phFocus");

/* ===== LEAFLET MAP ===== */
const map = L.map("leafletMap").setView([12.5, 121], 5);

L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
  attribution: "&copy; OpenStreetMap"
}).addTo(map);

/* USGS LIVE FEED (Past Day) */
const quakes = L.geoJSON(null, {
  pointToLayer: (f, latlng) => {
    const m = f.properties.mag;
    return L.circleMarker(latlng, {
      radius: m * 2.5,
      color: "#ef4444",
      fillOpacity: 0.75
    });
  }
}).addTo(map);

fetch("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson")
  .then(r => r.json())
  .then(d => quakes.addData(d));

/* FAULT LINES (replace with PHIVOLCS if available) */
fetch("https://raw.githubusercontent.com/fraxen/tectonicplates/master/GeoJSON/PB2002_boundaries.json")
  .then(r => r.json())
  .then(d => L.geoJSON(d, {
    style:{ color:"#facc15", weight:1 }
  }).addTo(map));

/* PH Focus */
phBtn.onclick = () => map.setView([12.8797,121.7740],6);

/* ===== SAFETY CAROUSEL ===== */
let currentSlide = 1;
const totalSlides = 3;
let shakeTimeout;
let shakeInterval;

// Initialize carousel
updateCarousel();

// Navigation buttons
document.getElementById('prevBtn').addEventListener('click', () => {
  if (currentSlide > 1) {
    currentSlide--;
    updateCarousel();
  }
});

document.getElementById('nextBtn').addEventListener('click', () => {
  if (currentSlide < totalSlides) {
    currentSlide++;
    updateCarousel();
  }
});

// Dot navigation
document.querySelectorAll('.slide-dot').forEach(dot => {
  dot.addEventListener('click', () => {
    currentSlide = parseInt(dot.dataset.slide);
    updateCarousel();
  }
  );
});

// Carousel update function
function updateCarousel() {
  // Clear any pending shake timeouts
  if (shakeTimeout) {
    clearTimeout(shakeTimeout);
  }
  
  // Clear any existing shake interval
  if (shakeInterval) {
    clearInterval(shakeInterval);
  }
  
  // Reset all slides' scroll positions first
  for (let i = 1; i <= totalSlides; i++) {
    const slide = document.getElementById(`slide${i}`);
    const scrollable = slide.querySelector('.slide-scrollable');
    if (scrollable) {
      scrollable.scrollTop = 0;
    }
  }
  
  // Update slides with transition
  setTimeout(() => {
    for (let i = 1; i <= totalSlides; i++) {
      const slide = document.getElementById(`slide${i}`);
      slide.classList.remove('active', 'prev', 'next');
      
      if (i === currentSlide) {
        slide.classList.add('active');
      } else if (i < currentSlide) {
        slide.classList.add('prev');
      } else {
        slide.classList.add('next');
      }
    }
  }, 10);
  
  // Update dots
  document.querySelectorAll('.slide-dot').forEach(dot => {
    dot.classList.remove('active');
    if (parseInt(dot.dataset.slide) === currentSlide) {
      dot.classList.add('active');
    }
  });
  
  // Update buttons
  document.getElementById('prevBtn').disabled = currentSlide === 1;
  document.getElementById('nextBtn').disabled = currentSlide === totalSlides;
  
  // Start shaking only for slide 2 (During)
  if (currentSlide === 2) {
    // Start shaking after slide transition completes
    shakeTimeout = setTimeout(() => {
      startRandomShaking();
    }, 500);
  }
}

function startRandomShaking() {
  // Clear any existing interval first
  if (shakeInterval) {
    clearInterval(shakeInterval);
  }
  
  // Create random shaking pattern
  shakeInterval = setInterval(() => {
    // Random pause between shakes
    const pauseDuration = Math.random() * 1000 + 500; // 500-1500ms
    
    // Clear any existing timeouts
    if (shakeTimeout) {
      clearTimeout(shakeTimeout);
    }
    
    // Wait for random pause, then shake again
    shakeTimeout = setTimeout(() => {
      // Don't shake if we're no longer on slide 2
      if (currentSlide !== 2) {
        clearInterval(shakeInterval);
        return;
      }
    }, pauseDuration);
  }, 2000); // Check every 2 seconds if we should shake again
}

// Stop shaking when leaving safety page
function stopAllShaking() {
  if (shakeTimeout) {
    clearTimeout(shakeTimeout);
  }
  if (shakeInterval) {
    clearInterval(shakeInterval);
  }
}

/* ===== NAVIGATION ===== */
tabs.forEach(t => t.onclick = () => {
  tabs.forEach(x => x.classList.remove("active"));
  t.classList.add("active");

  hazard.style.display =
  risk.style.display =
  mapDiv.style.display =
  info.style.display =
  safety.style.display = "none";
  phBtn.style.display = "none";

  if (t.dataset.tab === "hazard") hazard.style.display = "block";
  if (t.dataset.tab === "risk") risk.style.display = "block";
  if (t.dataset.tab === "recent") {
    mapDiv.style.display = "block";
    phBtn.style.display = "block";
    map.invalidateSize();
  }
  if (t.dataset.tab === "about") info.style.display = "block";
  if (t.dataset.tab === "safety") {
    safety.style.display = "block";
    // Reset to first slide when entering safety section
    currentSlide = 1;
    updateCarousel();
  } else {
    stopAllShaking();
  }
});

// Keyboard navigation for carousel
document.addEventListener('keydown', (e) => {
  if (!safety.style.display || safety.style.display === 'none') return;
  
  if (e.key === 'ArrowLeft' && currentSlide > 1) {
    currentSlide--;
    updateCarousel();
  } else if (e.key === 'ArrowRight' && currentSlide < totalSlides) {
    currentSlide++;
    updateCarousel();
  } else if (e.key >= '1' && e.key <= '3') {
    currentSlide = parseInt(e.key);
    updateCarousel();
  }
});

// Clean up when page is hidden
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    stopAllShaking();
  }
});
</script>
</body>
</html>